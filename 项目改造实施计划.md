# 项目改造实施计划

## 一、项目概述

将现有微服务架构改造为类似掘金的技术内容分享平台，支持百万级用户规模，具备完整的权限体系与内容生态闭环。

## 二、实施阶段

### 阶段一：数据库设计与基础服务（已完成 ✅）

- [x] 数据库ER图设计
- [x] SQL脚本创建（用户扩展、内容、统计、审计）
- [x] 数据库设计文档

### 阶段二：用户体系完善（进行中）

#### 2.1 认证服务扩展
- [ ] 邮箱注册与验证
- [ ] 忘记密码流程
- [ ] 微信扫码登录完善
- [ ] 邮箱验证码服务

#### 2.2 用户服务扩展
- [ ] 用户扩展信息管理
- [ ] 用户关注功能
- [ ] 用户资料完善

### 阶段三：权限体系完善

#### 3.1 菜单权限关联
- [ ] 菜单权限关联表实现
- [ ] 菜单树权限控制
- [ ] 按钮权限级联绑定

#### 3.2 数据权限实现
- [ ] 数据权限过滤Service
- [ ] 访问级别控制
- [ ] 专题/文章权限校验

### 阶段四：内容服务模块

#### 4.1 内容服务创建
- [ ] 创建 content-service 模块
- [ ] 文章管理（CRUD、发布、下架、版本管理）
- [ ] 专题管理
- [ ] 分类管理
- [ ] 标签管理
- [ ] 评论系统（多级回复、审核）
- [ ] 沸点管理

#### 4.2 内容交互
- [ ] 文章点赞/收藏
- [ ] 评论点赞
- [ ] 内容分享

### 阶段五：统计分析服务

#### 5.1 统计服务创建
- [ ] 创建 statistics-service 模块
- [ ] 事件日志记录
- [ ] PV/UV统计
- [ ] 访问路径分析
- [ ] 来源渠道统计
- [ ] 内容排行统计
- [ ] 用户画像统计
- [ ] 标签热度统计

#### 5.2 埋点系统
- [ ] 前端埋点SDK
- [ ] 后端事件接收
- [ ] 实时统计计算

### 阶段六：审计日志系统

#### 6.1 审计服务
- [ ] 创建 audit-service 模块
- [ ] 操作日志记录
- [ ] 变更字段追踪
- [ ] 日志查询与导出

#### 6.2 AOP切面
- [ ] 统一审计切面
- [ ] 自动记录操作日志
- [ ] 敏感操作告警

### 阶段七：前端后台管理

#### 7.1 系统管理页面
- [ ] 菜单管理（树形结构、权限绑定）
- [ ] 角色管理（权限分配）
- [ ] 账号管理（CRUD、重置密码）
- [ ] 权限管理

#### 7.2 内容管理页面
- [ ] 文章管理
- [ ] 专题管理
- [ ] 分类管理
- [ ] 评论审核
- [ ] 沸点管理

#### 7.3 统计分析页面
- [ ] 数据概览
- [ ] 访问统计
- [ ] 内容排行
- [ ] 用户画像

### 阶段八：前端内容前台

#### 8.1 内容展示
- [ ] 文章列表/详情
- [ ] 专题页面
- [ ] 沸点动态
- [ ] 分类/标签页

#### 8.2 内容发布
- [ ] 文章编辑器（Markdown/富文本）
- [ ] 沸点发布
- [ ] 专题创建

#### 8.3 交互功能
- [ ] 评论系统（多级回复、@提及）
- [ ] 点赞/收藏
- [ ] 分享功能

### 阶段九：多语言支持

#### 9.1 后端i18n
- [ ] 完善i18n组件
- [ ] 错误消息国际化
- [ ] 业务消息国际化

#### 9.2 前端i18n
- [ ] Vue i18n集成
- [ ] 中文简体
- [ ] 英文
- [ ] 语言切换

### 阶段十：性能优化与安全

#### 10.1 性能优化
- [ ] 缓存策略优化
- [ ] 数据库索引优化
- [ ] 分页查询优化
- [ ] 全文搜索优化

#### 10.2 安全加固
- [ ] 数据脱敏
- [ ] 防刷机制
- [ ] IP限流
- [ ] 敏感词过滤

## 三、技术架构设计

### 3.1 服务拆分

```
gateway (网关服务)
├── auth-service (认证服务)
├── user-service (用户服务)
├── content-service (内容服务) [新增]
├── statistics-service (统计服务) [新增]
└── audit-service (审计服务) [新增]
```

### 3.2 核心服务职责

#### content-service (内容服务)
- 文章管理
- 专题管理
- 分类/标签管理
- 评论管理
- 沸点管理
- 内容交互（点赞、收藏、分享）

#### statistics-service (统计服务)
- 事件日志记录
- 访问统计计算
- 内容排行计算
- 用户画像分析
- 标签热度计算

#### audit-service (审计服务)
- 操作日志记录
- 变更追踪
- 日志查询
- 安全审计

### 3.3 数据权限实现方案

#### 功能权限（BUTTON）
- 通过 `sys_role_permission` 关联
- 在Controller层进行权限校验
- 前端根据权限显示/隐藏按钮

#### 数据权限（DATA）
- 通过权限类型 `DATA` 标识
- 在Service层进行数据过滤
- 支持：全部、部门、自己三种级别

#### 访问级别控制
- PUBLIC：公开访问
- PRIVATE：私有（仅作者）
- PAID：付费可见
- SPECIFIED：指定用户可见

### 3.4 统计分析实现方案

#### 事件日志
- 前端埋点 → Gateway → statistics-service
- 异步处理，不阻塞主流程
- 支持实时统计和离线分析

#### 统计计算
- 每日定时任务计算统计数据
- 支持实时查询和离线分析
- 使用Redis缓存热点数据

## 四、API设计规范

### 4.1 RESTful规范
- GET：查询
- POST：新增
- PUT：修改
- DELETE：删除

### 4.2 统一响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

### 4.3 分页响应
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "list": [],
    "total": 100,
    "pageNum": 1,
    "pageSize": 10
  }
}
```

## 五、开发规范

### 5.1 代码规范
- DDD分层架构
- 统一异常处理
- 统一参数校验
- 统一日志记录

### 5.2 数据库规范
- 逻辑删除（deleted字段）
- 创建时间、更新时间自动维护
- 索引优化
- 字段注释完整

### 5.3 接口规范
- 统一返回格式
- 统一异常处理
- 参数校验
- 接口文档（Swagger）

## 六、测试计划

### 6.1 单元测试
- Service层单元测试
- Repository层单元测试
- 工具类单元测试

### 6.2 集成测试
- API接口测试
- 数据库操作测试
- 服务间调用测试

### 6.3 性能测试
- 并发测试
- 压力测试
- 数据库性能测试

## 七、部署方案

### 7.1 开发环境
- 本地开发
- Docker Compose

### 7.2 生产环境
- Kubernetes部署
- 服务注册与发现（Nacos）
- 配置中心（Nacos）
- 监控告警（Sentinel）

## 八、后续扩展

1. **课程/直播模块**
   - 课程管理
   - 直播管理
   - 付费课程

2. **消息通知**
   - 站内消息
   - 邮件通知
   - 推送通知

3. **积分系统**
   - 积分规则
   - 积分商城
   - 积分兑换

4. **AI推荐**
   - 内容推荐
   - 个性化推荐
   - 智能标签

